#!/bin/bash
# Script para configurar Cloud SQL no Cloud Run

echo "üîß CONFIGURANDO CLOUD SQL PARA SEU PROJETO"
echo "=========================================="
echo ""

echo "üìã Informa√ß√µes extra√≠das:"
echo "- Usu√°rio do banco: derivada"
echo "- Senha do banco: derivada"
echo "- Nome do banco: postgres"
echo "- Projeto: bold-artifact-463813-e9 (assumindo pelo screenshot)"
echo "- Regi√£o: us-central1"
echo "- Inst√¢ncia: admin"
echo ""

echo "üõ†Ô∏è COMANDO PARA EXECUTAR:"
echo "========================="
echo ""
echo "gcloud run services update rrdd-519104831129 \\"
echo "  --region=us-central1 \\"
echo "  --set-env-vars DATABASE_URL='postgresql://derivada:derivada@/postgres?host=/cloudsql/bold-artifact-463813-e9:us-central1:admin' \\"
echo "  --add-cloudsql-instances=bold-artifact-463813-e9:us-central1:admin"
echo ""

echo "üìù EXPLICA√á√ÉO DA DATABASE_URL:"
echo "=============================="
echo "postgresql://derivada:derivada@/postgres?host=/cloudsql/bold-artifact-463813-e9:us-central1:admin"
echo ""
echo "Partes:"
echo "- derivada:derivada = usu√°rio:senha (do seu banco atual)"
echo "- @/ = sem IP direto (usa proxy)"
echo "- postgres = nome do banco"
echo "- host=/cloudsql/... = conex√£o via Cloud SQL Proxy"
echo "- bold-artifact-463813-e9:us-central1:admin = CONNECTION_NAME"
echo ""

echo "‚ö†Ô∏è IMPORTANTE VERIFICAR:"
echo "========================"
echo "1. Se o usu√°rio 'derivada' existe no Cloud SQL"
echo "2. Se a senha 'derivada' est√° correta"
echo "3. Se o banco 'postgres' existe"
echo "4. Se o projeto √© realmente 'bold-artifact-463813-e9'"
echo ""

echo "üîç PARA VERIFICAR O CONNECTION NAME:"
echo "===================================="
echo "No Google Cloud Console:"
echo "1. V√° em SQL > admin"
echo "2. Na aba 'Vis√£o geral'"  
echo "3. Procure por 'Nome da conex√£o' ou 'Connection name'"
echo "4. Deve ser algo como: PROJETO:REGI√ÉO:INST√ÇNCIA"
echo ""

echo "üß™ TESTE R√ÅPIDO (opcional):"
echo "=========================="
echo "Se quiser testar primeiro com IP p√∫blico:"
echo "1. Habilite IP p√∫blico na inst√¢ncia"
echo "2. Use: DATABASE_URL='postgresql://derivada:derivada@IP_PUBLICO:5432/postgres?sslmode=require'"
echo ""
